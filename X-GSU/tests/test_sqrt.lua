--emu.log(string.format("%x", emu.readWord(0x59b,emu.memType.gsuWorkRam,false)))
--emu.log("input")
--emu.log(emu.getLabelAddress("input"))
input = {0x0,0x100,0x200,0x300,0x400,0x500,0x600,0x700,0x800,0x900,0xa00,0xb00,0xc00,0xd00,0xe00,0xf00,0x1000,0x1100,0x1200,0x1300,0x1400,0x1500,0x1600,0x1700,0x1800,0x1900,0x1a00,0x1b00,0x1c00,0x1d00,0x1e00,0x1f00,0x2000,0x2100,0x2200,0x2300,0x2400,0x2500,0x2600,0x2700,0x2800,0x2900,0x2a00,0x2b00,0x2c00,0x2d00,0x2e00,0x2f00,0x3000,0x3100,0x3200,0x3300,0x3400,0x3500,0x3600,0x3700,0x3800,0x3900,0x3a00,0x3b00,0x3c00,0x3d00,0x3e00,0x3f00,0x4000,0x4100,0x4200,0x4300,0x4400,0x4500,0x4600,0x4700,0x4800,0x4900,0x4a00,0x4b00,0x4c00,0x4d00,0x4e00,0x4f00,0x5000,0x5100,0x5200,0x5300,0x5400,0x5500,0x5600,0x5700,0x5800,0x5900,0x5a00,0x5b00,0x5c00,0x5d00,0x5e00,0x5f00,0x6000,0x6100,0x6200,0x6300,0x6400,0x6500,0x6600,0x6700,0x6800,0x6900,0x6a00,0x6b00,0x6c00,0x6d00,0x6e00,0x6f00,0x7000,0x7100,0x7200,0x7300,0x7400,0x7500,0x7600,0x7700,0x7800,0x7900,0x7a00,0x7b00,0x7c00,0x7d00,0x7e00,0x7f00,0x8000,0x8100,0x8200,0x8300,0x8400,0x8500,0x8600,0x8700,0x8800,0x8900,0x8a00,0x8b00,0x8c00,0x8d00,0x8e00,0x8f00,0x9000,0x9100,0x9200,0x9300,0x9400,0x9500,0x9600,0x9700,0x9800,0x9900,0x9a00,0x9b00,0x9c00,0x9d00,0x9e00,0x9f00,0xa000,0xa100,0xa200,0xa300,0xa400,0xa500,0xa600,0xa700,0xa800,0xa900,0xaa00,0xab00,0xac00,0xad00,0xae00,0xaf00,0xb000,0xb100,0xb200,0xb300,0xb400,0xb500,0xb600,0xb700,0xb800,0xb900,0xba00,0xbb00,0xbc00,0xbd00,0xbe00,0xbf00,0xc000,0xc100,0xc200,0xc300,0xc400,0xc500,0xc600,0xc700,0xc800,0xc900,0xca00,0xcb00,0xcc00,0xcd00,0xce00,0xcf00,0xd000,0xd100,0xd200,0xd300,0xd400,0xd500,0xd600,0xd700,0xd800,0xd900,0xda00,0xdb00,0xdc00,0xdd00,0xde00,0xdf00,0xe000,0xe100,0xe200,0xe300,0xe400,0xe500,0xe600,0xe700,0xe800,0xe900,0xea00,0xeb00,0xec00,0xed00,0xee00,0xef00,0xf000,0xf100,0xf200,0xf300,0xf400,0xf500,0xf600,0xf700,0xf800,0xf900,0xfa00,0xfb00,0xfc00,0xfd00,0xfe00,0xff00}
expected = {0x0,0x100,0x16a,0x1bb,0x200,0x23c,0x273,0x2a5,0x2d4,0x300,0x329,0x351,0x376,0x39b,0x3bd,0x3df,0x400,0x41f,0x43e,0x45b,0x478,0x495,0x4b0,0x4cb,0x4e6,0x500,0x519,0x532,0x54a,0x562,0x57a,0x591,0x5a8,0x5be,0x5d4,0x5ea,0x600,0x615,0x62a,0x63e,0x653,0x667,0x67b,0x68e,0x6a2,0x6b5,0x6c8,0x6db,0x6ed,0x700,0x712,0x724,0x736,0x747,0x759,0x76a,0x77b,0x78c,0x79d,0x7ae,0x7be,0x7cf,0x7df,0x7ef,0x800,0x80f,0x81f,0x82f,0x83f,0x84e,0x85d,0x86d,0x87c,0x88b,0x89a,0x8a9,0x8b7,0x8c6,0x8d4,0x8e3,0x8f1,0x900,0x90e,0x91c,0x92a,0x938,0x946,0x953,0x961,0x96f,0x97c,0x98a,0x997,0x9a4,0x9b2,0x9bf,0x9cc,0x9d9,0x9e6,0x9f3,0xa00,0xa0c,0xa19,0xa26,0xa32,0xa3f,0xa4b,0xa58,0xa64,0xa70,0xa7c,0xa89,0xa95,0xaa1,0xaad,0xab9,0xac5,0xad1,0xadc,0xae8,0xaf4,0xb00,0xb0b,0xb17,0xb22,0xb2e,0xb39,0xb44,0xb50,0xb5b,0xb66,0xb72,0xb7d,0xb88,0xb93,0xb9e,0xba9,0xbb4,0xbbf,0xbca,0xbd5,0xbdf,0xbea,0xbf5,0xc00,0xc0a,0xc15,0xc1f,0xc2a,0xc34,0xc3f,0xc49,0xc54,0xc5e,0xc68,0xc73,0xc7d,0xc87,0xc91,0xc9c,0xca6,0xcb0,0xcba,0xcc4,0xcce,0xcd8,0xce2,0xcec,0xcf6,0xd00,0xd09,0xd13,0xd1d,0xd27,0xd30,0xd3a,0xd44,0xd4d,0xd57,0xd61,0xd6a,0xd74,0xd7d,0xd87,0xd90,0xd99,0xda3,0xdac,0xdb6,0xdbf,0xdc8,0xdd1,0xddb,0xde4,0xded,0xdf6,0xe00,0xe09,0xe12,0xe1b,0xe24,0xe2d,0xe36,0xe3f,0xe48,0xe51,0xe5a,0xe63,0xe6c,0xe74,0xe7d,0xe86,0xe8f,0xe98,0xea0,0xea9,0xeb2,0xebb,0xec3,0xecc,0xed5,0xedd,0xee6,0xeee,0xef7,0xf00,0xf08,0xf11,0xf19,0xf21,0xf2a,0xf32,0xf3b,0xf43,0xf4c,0xf54,0xf5c,0xf65,0xf6d,0xf75,0xf7d,0xf86,0xf8e,0xf96,0xf9e,0xfa7,0xfaf,0xfb7,0xfbf,0xfc7,0xfcf,0xfd7,0xfdf,0xfe7,0xfef,0xff7}
index = 1
output = 0x0
fail = 0

function setupFirstTest(address, value) 
	emu.log(string.format("%x",input[index]))
	emu.writeWord(0x5B0,input[index],emu.memType.gsuWorkRam)
end

emu.addMemoryCallback(setupFirstTest, 
					  emu.callbackType.exec, 
					  0x003,
					  0x003, 
					  4,
					  emu.memType.gsuWorkRam)

function setNextInput() 
	emu.writeWord(0x5B0,input[index],emu.memType.gsuWorkRam)
end

function compareAndLogOutput(address, value)
	local read = emu.readWord(0x5B2,emu.memType.gsuWorkRam,false)
	
	emu.log("Checking")
	
	if read ~= expected[index] then  
		fail = 1
		emu.log(input[index])
		emu.log(read)
		emu.log(expected[index])
		emu.log(string.format("Error sqrt(%x) was %x expected %x", input[index],read,expected[index]))
	end	
	index=index+1
	loopOrExit()
end

function loopOrExit() 
	if index > 256 then
		emu.log("Done")
		--emu.stop(fail)
		emu.breakExecution()
	else 		
		setNextInput()
	end
end


emu.addMemoryCallback(compareAndLogOutput, 
					  emu.callbackType.exec, 
					  0x0030,
					  0x0030, 
					  4,
					  emu.memType.gsuWorkRam)